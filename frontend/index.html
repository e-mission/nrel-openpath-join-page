<!DOCTYPE html>

<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="Content-Security-Policy" content="base-uri 'self'; default-src 'self' 'unsafe-inline' data: https://raw.githubusercontent.com https://cdn.jsdelivr.net https://stackpath.bootstrapcdn.com https://fonts.googleapis.com/ https://fonts.gstatic.com https://cdnjs.cloudflare.com https://code.jquery.com https://kit.fontawesome.com https://ka-f.fontawesome.com;">
		<title>NREL CanBikeCO Dashboard</title>

		<!-- == APPLICATION HEAD == -->
		<!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KG7PVKB');</script>
		<!-- End Google Tag Manager -->

		<!-- Search engine code -->
		<!--#config timefmt="%Y-%m-%d@%H:%M:%S %Z" -->
		<meta http-equiv="last-modified" content="<!--#echo var='LAST_MODIFIED'-->">

		<!-- Favicon -->
		<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

		<!-- iOS icons -->
		<link rel="apple-touch-icon" href="client/img/touch-icon-iphone.png">
		<link rel="apple-touch-icon" sizes="72x72"   href="client/img/touch-icon-ipad.png">
		<link rel="apple-touch-icon" sizes="114x114" href="client/img/touch-icon-iphone-retina.png">
		<link rel="apple-touch-icon" sizes="144x144" href="client/img/touch-icon-ipad-retina.png">

		<!-- GLOBAL styles -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link href="client/css/nrel.complete.min.css" rel="stylesheet" type="text/css" >

		<!-- NREL Application styles -->
		<link href="client/css/nrel.application.min.css" rel="stylesheet" type="text/css" >

		<!-- Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"> 

		<!-- Font Awesome -->
		<script src="https://kit.fontawesome.com/32f532493a.js" crossorigin="anonymous"></script>

		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.6.1.min.js"   integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="   crossorigin="anonymous"></script>

        <!-- QRcode -->
        <script src="client/js/qrcode.js"></script>

    <!-- i18n from CDN-->
    <script src="https://cdn.jsdelivr.net/npm/cldrpluralruleparser@1.4.0/dist/cldrpluralruleparser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.messagestore.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.fallbacks.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.language.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.parser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.emitter.min.js"></script>

    <!-- Language button styling -->    

      <style>

      .box {
        height: 36px;
        width: 110px;
        background-color: #ffffff;
        outline: 2px solid rgb(141, 195, 239);
      }
      .boxOption {
        background-color: rgb(255, 255, 255);
      }      

      </style>

		<!-- == END APPLICATION HEAD == -->
	</head>
	<body>

    <!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KG7PVKB"
              height="0" width="0" style="display:none;visibility:hidden" sandbox="allow-same-origin"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Site application banner -->
    <!--stopindex-->
    <a href="#content" class="sr-only app">Skip to main content</a>

    <header id="banner">
    <div class="banner-logo">
    <div class="container app">
      <div class="row">

        <div class="col-md-6 col-xl-4 order-md-2">
          <a href="http://www.nrel.gov"><div class="logo"><img src="client/img/nrel-logo-web.svg" height="100%" width="100%" alt="National Renewable Energy Laboratory" /></div></a>
        </div>

        <div class="col-12 d-md-none">
          <!-- Start MOBILE collapsible site search bar -->
          <div class="site-search-bar">
            <div class="container">
              <div class="row">
                <div class="col d-flex justify-content-center mb-1">
                  <nav class="navbar navbar-light">
                    <div class="navbar-collapse collapse" id="searchbar-collapse-mobile">
                      <form
                          method="get"
                          class="site-searchbar-form form-inline ThunderstoneForm"
                          action="https://search4.nrel.gov/texis/search/" 
                          id="ThunderstoneSearchForm">

                        <input type="hidden" name="pr" value="metanrel" />
                        <div class="form-group">
                            <label for="query" class="searchFiler sr-only">NREL.gov</label>
                            <input
                                type="search"
                                id="query" name="query"
                                maxlength="2047"
                                placeholder="NREL.gov"
                                class="form-control"
                                aria-label="NREL.gov">
                            <button type="submit" class="search btn btn-default">Search</button>
                        </div>
                      </form>
                    </div>
                  </nav>
                </div>
              </div>
            </div>
          </div>    
          <!-- End MOBILE collapsible site search bar -->
        </div>

        <div class="col-md-6 col-xl-8 order-md-1">
            <p></p>
            <a style="display:inline;" id="pageTitle" class="app-name">NREL OpenPATH</a>
            <a style="display:inline;" data-i18n="joinPage" class="app-name">Join Page</a>
        </div>

      </div>
    </div>
    </div>
    </header>
    <!--startindex-->


    <!-- TOP NAVIGATION -->
    <!--stopindex-->
    <div class="program-header">
    <div class="container">
    <nav class="navbar navbar-expand-md navbar-light">

      <div id="program-menu" class="mr-auto">
        <button class="custom-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#topnav-collapse" aria-controls="topnav-collapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggle-label">Menu</span>
        </button>
      </div>

      <!-- Navigation -->
      <div class="navbar-collapse collapse" id="topnav-collapse">
        
        <ul class="nav navbar-nav">
          <li data-topnav="Public Dashboard" class="nav-item"><a id="publicDashboardLink" href="should_be_the_public_dashboard_link" data-i18n="publicDashboard" class="nav-link">Public Dashboard</a></li>
          <li data-topnav="Participant Guidelines" class="nav-item"><a id="participantGuidelinesLink" href="https://www.nrel.gov/transportation/openpath-participant-guidelines.html" data-i18n="participantGuidelines" class="nav-link">Participant Guidelines</a></li>
          <li data-topnav="TSDC" class="nav-item"><a id="TSDCLink" href="https://www.nrel.gov/transportation/secure-transportation-data/index.html" data-i18n="tsdc" class="nav-link">TSDC</a></li>
        </ul>
        <ul class="nav navbar-nav ml-auto">
          <!--Navigation tabs are commented out for reference
          <li class="nav-item"><a href="#" class="nav-link">Login</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Help</a></li>
          -->
        </ul>
        <!-- desktop search button -->
        <button type="button" class="custom-toggler site-navbar-toggler site-searchbar-toggle d-none d-md-inline" data-toggle="collapse" data-target="#searchbar-collapse" aria-expanded="false" aria-label="Toggle Search">
          <span class="fa fa-search" aria-hidden="true"></span>
        </button>

      <!-- Language select button-->
      <div class="lead">
        <select name="Select language" id="langSel" class="language box custom-select sources" onchange="setLangAndRedisplayPage()" disabled>
          <option class="boxOption" value="en">English</option>;
          <option class="boxOption" value="es">Español</option>;
          <!-- <option class="boxOption" value="it">Italiano</option>;-->
          <!-- <option class="boxOption" value="fr">Français</option>;-->  
        </select>
      </div>

      </div>

    </nav>
    </div><!--container-->
    </div><!--program-header-->
    <!-- mobile search button -->
    <button type="button" class="custom-toggler site-navbar-toggler site-searchbar-toggle d-md-none" data-toggle="collapse" data-target="#searchbar-collapse-mobile" aria-expanded="false" aria-label="Toggle Search">
    <span class="fa fa-search" aria-hidden="true"></span>
    </button>   
    <!-- Start collapsible site search bar -->
    <div class="site-search-bar">
    <div class="container">
    <div class="row">
      <div class="col">
        <nav class="navbar navbar-light">
          <div class="navbar-collapse collapse" id="searchbar-collapse">
            <form
                method="get"
                class="site-searchbar-form form-inline ThunderstoneForm"
                action="https://search4.nrel.gov/texis/search/" 
                id="ThunderstoneSearchForm">

              <input type="hidden" name="pr" value="metanrel" />
              <div class="form-group">
                  <label for="query" class="SearchFiler sr-only">NREL.gov</label>
                  <input
                      type="search"
                      id="query" name="query"
                      maxlength="2047"
                      placeholder="NREL.gov"
                      class="form-control"
                      aria-label="NREL.gov">
                  <button type="submit" class="Search btn btn-default">Search</button>
              </div>
            </form>
          </div>
        </nav>
      </div>
    </div>
    </div>
    </div>  
    
    <!-- End collapsible site search bar -->
    <!--startindex-->

		<div class="container" id="content" role="main">
         <div class="row">
            <div class="col-lg-9">
               <h1 id="studyTitleOne"></h1>
               <p class="greeting"></p>

              <p style="display:inline;">
                <span data-i18n="thankYouMessage" class="lead">Thank you for participating in the </span>
                <span id="studyTitleTwo" class="lead"></span>
                <span>.</span>
              </p>

              <p></p> <!-- Adds a precise space-->
                              
               <h2 data-i18n="studyPurpose">Purpose of Study</h2>

               <p id="shortTextualDescription"></p>
               
               <h2 data-i18n="dataCollection">Data Collection</h2>
               
               <p style="display:inline;">
                <span data-i18n="dC1">We use the </span>
                <a href="https://www.nrel.gov/transportation/openpath.html">NREL OpenPATH</a> 
                <span data-i18n="dC2"> platform for this data collection. This open-source platform collects a complete snapshot 
                  of your travel and uses it to estimate yourindividual transportation carbon 
                  footprint and compare it against US 2030 and 2050 carbon-reduction goals. It also computes and 
                  publishes aggregate metrics around mode share and distance traveled. </span> 
               </p>

               <p></p> <!-- Adds a precise space-->

               <div class="row justify-content-center">
                     
                 <div class="col-md-6 mb-4"><img id="OpenPATH-dashboard-image" class="img-responsive img-fluid" src="client/img/OpenPATH-dashboard-preview-en.png" alt="OpenPATH dashboard preview"></div>
                 <div class="col-md-6 mb-4"><img id="" class="img-responsive img-fluid" src="client/img/public-dashboard-preview.png" alt="Public dashboard preview"></div>

               </div>
               <p id="whyWeCollect"></p>
               
               <h2 data-i18n="installNREL">Install the NREL OpenPATH App on Your Phone</h2>
               
               <ol>
                  <li>
                    <p style="display:inline;">
                      <span data-i18n="iN1">Download the NREL OpenPATH app from the</span>
                      <a href="https://apps.apple.com/us/app/nrel-openpath/id1628058068">Apple Store</a>
                      <span data-i18n="iN2"> or </span>
                      <a href="https://play.google.com/store/apps/details?id=gov.nrel.cims.openpath">Google Play Store</a>
                      <span>.</span>
                      
                    </p>
                  </li>
                  
                  <li data-i18n="iN3">Scan the QR code or visit the link below to join this program.</li>
                  
                  <li data-i18n="iN4">Remember to give all the requested permissions, including ("always") background location
                     access. If you have a Samsung or Huawei phone, turn off background restrictions.
                  </li>
                  
                  <li data-i18n="iN5">Track your trips, label them when prompted, and check out your carbon footprint.</li>
                  
               </ol>
               <p style="display:inline;">
                <span data-i18n="iN6">For additional information, see the </span>
                <a data-i18n="iN7" href="https://www.nrel.gov/transportation/openpath-participant-guidelines.html">participant guidelines</a>
                <span>.</span>
              </p>
               
               <div id="validStudy" class="well text-center">
                  
                  <h2 data-i18n="joinStudy">Join the Study</h2>

                  <p data-i18n="jS1">After you have installed the NREL OpenPATH app on your phone, join the study by scanning
                     the QR code or visiting the link below using your phone.
                  </p>

                  <div class="row justify-content-center">
                     
                    <div id="qrcode" style="width:100px; height:100px; margin-top:15px;"></div>
                  </div>

                  <p><span id="opCodeText"></span><span>&nbsp;&nbsp;&nbsp;</span><span class="fa fa-copy" id="opCodeCopy"></span></p>


                    <span data-i18n="[html]jS2">You will log in using a randomly token. Save your token in case you lose or
                      change phones. If you lose your token, NREL cannot retrieve it for you since we do
                      not have the ability to match a token to an individual user.</span>

               </div>
               <div id="validProgram" class="well text-center">

                  <h2 data-i18n="joinStudy">Join the Study</h2>

                  <p data-i18n="[html]jP1">After you have installed the NREL OpenPATH app on your phone, join the program by scanning
                     the QR code or copy-pasting the opcode token provided by your program admin. The OPcode is a long string beginning with 'nrelop'
                  </p>

                  <div class="row justify-content-center">

                    <div id="program-instructions" class="row" style="width:400px; margin-top:15px;">
                        <img class="col col-50" src="client/img/capture_qr_code_mobile_phone.jpg">
                        <img class="col col-50" src="client/img/copy_paste_token.jpg">
                    </div>
                  </div>
                  
                    <span data-i18n="jP2">The OPcode is a randomly generated token. Save your token in case you lose or
                      change phones. If you lose your token, please contact your program admin for assistance. NREL cannot retrieve it for you since we do
                      not have the ability to match a token to an individual user.</span>
                  
               </div>
                <div id="invalidStudy" class="well text-center">
                  <h2 data-i18n="invalidStudyTitle" style="color:red;">Invalid Study</h2>
                  <b><p id="invalidLocation"></p></b>
                  <p id="invalidMessage"></p>
                  <i><p id="invalidContact"></p></i>
                </div>


               <h2 data-i18n="dataPrivacy">Data Privacy and Security</h2>
               
               <p style="display:inline;">
                <span data-i18n="dP1">The system </span>
                <strong data-i18n="dP2">will not</strong>
                <span data-i18n="dP3">collect any of the traditional personally identifiable information (i.e., no name,
                  email, or phone number).</span>
              </p>

              <p></p><!-- Adds a precise space-->

               <p id="tokenPrivacyInfo"></p>
               
               <p data-i18n="dP4">The collected data will be stored in a FEDRAMP-certified medium cluster at NREL and
                  encrypted both in transit and at rest. Data from this study will be stored separately
                  from other study data using the NREL-hosted version of the OpenPATH platform.
               </p>
               
               <p data-i18n="dP5">The raw data from this study will only be made available to:</p>
               
               <ul>
                
                  <li>
                    <p style="display:inline;">
                      <span data-i18n="dP6">Program administrators from </span>
                      <a id="deploymentPartnerName"></a>
                      <span data-i18n="dP7"> to monitor the </span>
                      <a id="programOrStudy"></a>
                      <span data-i18n="dP8"> and potentially send recommendations for alternate travel modes.</span>
                    </p>
                  </li>
                  
                  <li data-i18n="dP9">NREL OpenPATH developers for debugging.</li>

               </ul>
               
               <p style="display:inline;">
                <span data-i18n="dP10">On completion of the study, the data will be archived in NREL's </span>
                <a data-i18n="dP13" href="https://www.nrel.gov/transportation/secure-transportation-data/index.html">Transportation Secure Data Center</a>
                <span data-i18n="dP11"> to support travel behavior research.</span>
                </p>

                <p></p><!-- Adds a precise space-->
               
               <p data-i18n="dP12">Examples of research that might use the data include:</p>
               
               <div id="researchQuestions"></div>
               
               <h2 data-i18n="contact">Contact</h2>
               
               <div class="bio">
                  <p class="header">K. Shankari</p>
                  <p data-i18n="contactTitle" class="header-description">Postdoctoral Researcher, Director's Fellow</p><a href="mailto:K.Shankari@nrel.gov"><span class="fa fa-envelope" aria-hidden="true"></span>K.Shankari@nrel.gov</a><br><a href="tel:+1-303-384-6450"><span class="fa fa-phone-square" aria-hidden="true"></span>303-384-6450</a></div>
               
            </div>
				</nav>
 			</div><!--container-->
 		</div><!--program-header-->

 		<!-- == APPLICATION FOOTER | updated 3/2021 == -->
 		<!--stopindex-->
    <footer id="footer" class="hidden-print">

      <div class="footertop">
           <div class="container">
              <div class="row">
                  <div class="col-12 col-lg-5">
                      <a href="http://www.nrel.gov/index.html"><strong class="nrel">National Renewable Energy Laboratory</strong></a>
                  </div>
                  <div class="col col-lg-7">
                      <div class="d-flex flex-column flex-lg-row justify-content-lg-start global">
                          <div><a data-i18n="about" href="http://www.nrel.gov/about/index.html">About</a></div>
                          <div><a data-i18n="research" href="http://www.nrel.gov/research/index.html">Research</a></div>
                          <div><a data-i18n="workWithUs" href="http://www.nrel.gov/index.html">Work with Us</a></div>
                          <div><a data-i18n="news" href="http://www.nrel.gov/news/index.html">News</a></div>
                          <div><a data-i18n="careers" href="http://www.nrel.gov/careers/index.html">Careers</a></div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="footerbottom">
           <div class="container">
               <div class="row">
                  <div class="col-md-4 col-lg-5">
                      <div><a data-i18n="contactUs" href="http://www.nrel.gov/webmaster.html">Contact Us</a></div>
                      <div class="mt-2"><a data-i18n="visit" href="http://www.nrel.gov/about/visiting-nrel.html">Visit</a></div>
                      <div class="mt-2"><a data-i18n="subscribe" href="http://www.nrel.gov/news/subscribe.html">Subscribe</a></div>
                      <div class="mt-3">
                          <ul class="social-links list-inline">
                              <li class="list-inline-item"><a href="https://www.facebook.com/nationalrenewableenergylab" aria-label="Follow NREL on Facebook"><i class="fa fa-facebook-square"><!--facebook--></i></a>
                              </li>
                              <li class="list-inline-item"><a href="https://www.instagram.com/nationalrenewableenergylab/" aria-label="Follow NREL on Instagram"><i class="fa fa-instagram"><!--Instagram--></i></a></li>
                              <li class="list-inline-item"><a href="https://www.linkedin.com/company/national-renewable-energy-laboratory"
                                  aria-label="Follow NREL on Linked In"><i class="fa fa-linkedin-square"><!--Linked In--></i></a>
                              </li>
                              <li class="list-inline-item"><a href="https://www.youtube.com/user/NRELPR/" aria-label="Follow NREL on YouTube"><i class="fa fa-youtube"><!--You Tube--></i></a>
                              </li>
                              <li class="list-inline-item"><a href="https://twitter.com/nrel/" aria-label="Follow NREL on Twitter"><i class="fa fa-twitter"><!--twitter--></i></a>
                              </li>
                          </ul>
                      </div>
                  </div>
                  <div class="col-md-8 col-lg-7 globalsecondary">
                      <div class="row">
                          <div class="col-sm-6 col-lg-3">
                              <div class="mt-1"><a data-i18n="accessibility" href="http://www.nrel.gov/accessibility.html">Accessibility</a></div>
                              <div class="mt-1"><a data-i18n="disclaimer" href="http://www.nrel.gov/disclaimer.html">Disclaimer</a></div>
                              <div class="mt-1"><a data-i18n="snp" href="http://www.nrel.gov/security.html">Security and Privacy</a></div>
                              <div class="mt-1"><a data-i18n="siteFeedback" href="http://www.nrel.gov/webmaster.html">Site Feedback</a></div>
                          </div>
                          <div class="col-sm-6 col-lg-3">
            
                              <div class="mt-1"><a data-i18n="developers" href="https://developer.nrel.gov/">Developers</a></div>
                              <div class="mt-1"><a data-i18n="employees" href="https://thesource.nrel.gov/">Employees</a></div>
                          </div>
                      </div>
                  </div>
              </div>
               <hr />
               <div class="mt-4">
               <div class="row">
                   <div class="col-sm-5">
                       <a href="https://www.allianceforsustainableenergy.org/"><img class="mr-5 mb-3" src="client/img/alliance-logo_black.png" alt="Alliance for Sustainable Energy, LLC"></a>
                       <a href="https://www.energy.gov"><img src="client/img/logo-doe-footer.png" alt="U.S. Department of Energy" class="mb-3"></a>
                   </div>

                   <div class="col-12 col-sm-7">
                    <p class="nrel-attr" style="display:inline;">
                      <span data-i18n="ft1">The National Renewable Energy Laboratory is a national laboratory of the </span>
                      <a data-i18n="usde" href="https://www.energy.gov/">U.S. Department of Energy</a>,
                      <a data-i18n="oeere" href="https://www.energy.gov/eere/office-energy-efficiency-renewable-energy">Office of Energy Efficiency and Renewable Energy</a>
                      <span data-i18n="ft2">, operated by the </span>
                      <a data-i18n="ase" href="https://www.allianceforsustainableenergy.org/">Alliance for Sustainable Energy LLC</a>.
                    </p>

                    
                  </div>
              </div>
               </div>
          </div>
      </div>

  </footer>

    <!--startindex-->
		<!-- == END APPLICATION FOOTER == -->

		<!-- == GLOBAL APPLICATION SCRIPTS == -->
		<!-- Bootstrap -->
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<!-- Global scripts -->
		<script src="client/js/app.min.js"></script>

		<!-- Site application scripts -->
		<script src="client/js/plugins.min.js"></script>
		<script src="client/js/app.min.js"></script>

		<!-- Custom scripts -->
		<script type="text/javascript">
      /*
      * Copied and adapted from the phone `dynamic_config.js`
      * Adapted by supporting program name via parameter to make it
      * easier to test against localhost
      */
      const _getStudyName = function(connectUrl) {
        const _getFromParamOrDefault = function() {
          const param_study_name = new URL(connectUrl).searchParams.get("study_config");
          return param_study_name == null? "stage-program" : param_study_name;
        }
        const orig_host = new URL(connectUrl).hostname;
        // If we are running this on dev, use a param instead to enable testing
        if (orig_host == "localhost") { return _getFromParamOrDefault(); }
        const first_domain = orig_host.split(".")[0];
        if (first_domain == "openpath-stage") { return _getFromParamOrDefault(); }
        const openpath_index = first_domain.search("-openpath");
        if (openpath_index == -1) { return undefined; }
        const study_name = first_domain.substr(0,openpath_index);
        return study_name;
      }


      const _getSubGroup = function(connectUrl) {
        const param_subgroup_name = new URL(connectUrl).searchParams.get("sub_group");
        if (data.opcode?.subgroups?.length > 0) {
            if (data.opcode.subgroups.includes(param_subgroup_name)) {
                return param_subgroup_name;
            } else {
                throw new Error($.i18n("invalidSubgroupError", param_subgroup_name,
                    data.opcode.subgroups),
                    {"cause": {"found": param_subgroup_name,
                    "expected": data.opcode.subgroups}})
            }
        } else {
            return "default";
        }
      }

      // Adapted from https://stackoverflow.com/a/63363662/4040267
      // made available under a CC BY-SA 4.0 license

      const _getRandomString = function(length) {
        const randomInts = window.crypto.getRandomValues(new Uint8Array(length * 2));
        const randomChars = Array.from(randomInts).map((b) => String.fromCharCode(b));
        const randomString = randomChars.join("");
        const validRandomString = window.btoa(randomString).replace(/[+/]/g, "");
        const truncatedRandomString = validRandomString.substring(0, length);
        return truncatedRandomString;
     }

     const _isTester = function(connectUrl) {
        const param_tester = new URL(connectUrl).searchParams.get("tester");
        if (param_tester && param_tester == "true") {
            return true;
        }
        return false;
     }

      var curr_lang = "en"; // Default language is set to English
      var data;
      var STUDY_NAME;
      var OPCODE_AUTOGEN;

      const fillDynamicConfig = function() {
        // Title card
        const PAGE_TITLE_TEXT = `${data.intro.translated_text[curr_lang].deployment_name}`
        $('#pageTitle').text(PAGE_TITLE_TEXT);
        document.title = PAGE_TITLE_TEXT;

        // Navigation links
        const PUBLIC_DASHBOARD_LINK = data.server.connectUrl.replace("api", "public");;
        $('#publicDashboardLink').attr('href', PUBLIC_DASHBOARD_LINK);

        // Deployment partner content text
        const DEPLOYMENT_PARTNER_NAME = `${data.intro.translated_text[curr_lang].deployment_partner_name}`;
        $('#deploymentPartnerName').text(DEPLOYMENT_PARTNER_NAME);
        
        // Program or study specific differences
        const PROGRAM_OR_STUDY = `${data.intro.program_or_study}`;
        $('#programOrStudy').text(PROGRAM_OR_STUDY);

        // Study title content text
        const STUDY_TITLE_TEXT = DEPLOYMENT_PARTNER_NAME + ` ${data.intro.translated_text[curr_lang].deployment_name}`;
        $('#studyTitleOne').text(STUDY_TITLE_TEXT);
        $('#studyTitleTwo').text(STUDY_TITLE_TEXT);

        // Short textual description content text
        const SHORT_TEXTUAL_DESCRIPTION_TEXT = `${data.intro.translated_text[curr_lang].short_textual_description}`;
        $('#shortTextualDescription').text(SHORT_TEXTUAL_DESCRIPTION_TEXT);
        
        // Why we collect content text
        const WHY_WE_COLLECT_TEXT = `${data.intro.translated_text[curr_lang].why_we_collect}`;
        $('#whyWeCollect').text(WHY_WE_COLLECT_TEXT);

        // OpenPATH dashboard image preview
        var img = document.getElementById("OpenPATH-dashboard-image");
        img.src=`client/img/OpenPATH-dashboard-preview-${curr_lang}.png`;

        // console.log("Configured study text is "+$.i18n("tokenPrivacyInfoStudyText"));
        // console.log("Configuring the program text with "+DEPLOYMENT_PARTNER_NAME);
        // Token privacy content text
        const TOKEN_PRIVACY_INFO_STUDY_TEXT = $.i18n("tokenPrivacyInfoStudyText");
        const TOKEN_PRIVACY_INFO_PROGRAM_TEXT = $.i18n("tokenPrivacyInfoProgramText", DEPLOYMENT_PARTNER_NAME);
        // If it's a study, go with the study text. Else go with the program text
        const TOKEN_PRIVACY_INFO_TEXT = OPCODE_AUTOGEN? TOKEN_PRIVACY_INFO_STUDY_TEXT : TOKEN_PRIVACY_INFO_PROGRAM_TEXT;
        $('#tokenPrivacyInfo').text(TOKEN_PRIVACY_INFO_TEXT);

        // Research questions generation
        $("#cList").remove();
        $('#researchQuestions').append("<ul id='cList'></ul>");
        for (i = 0; i < 3; i++) { // 3 research questions maximum
          var RESEARCH_QUESTION_TEXT = `${data.intro.translated_text[curr_lang].research_questions[i]}`;
          if(RESEARCH_QUESTION_TEXT == "undefined") { // Skip the entry if is not defined.
            continue;
          }
          $("#cList").append("<li>" + RESEARCH_QUESTION_TEXT + "</li>");
        }

      };

      const setInvalid = function(invalidLoc, invalidMessage, invalidContact) {
        alert(invalidLoc + "\n\n\n" + invalidMessage+ "\n\n\n" + invalidContact);
        $('#validStudy').hide();
        $('#validProgram').hide();
        $('#invalidLocation').text(invalidLoc);
        $('#invalidMessage').text(invalidMessage);
        $('#invalidContact').text(invalidContact);
        $('#invalidStudy').show();
      }

      const validateAndGenerateToken = function() {
        try {
            const SUB_GROUP = _getSubGroup(window.location);
            const RANDOM_STRING = _getRandomString(32);
            const IS_TESTER = _isTester(window.location);
            const GEN_TOKEN = IS_TESTER? `nrelop_${STUDY_NAME}_${SUB_GROUP}_test_${RANDOM_STRING}` : `nrelop_${STUDY_NAME}_${SUB_GROUP}_${RANDOM_STRING}`
            const JOIN_CODE = `nrelopenpath://login_token?token=${GEN_TOKEN}`
            // Generate study-join QR code
            var qrcode = new QRCode(document.getElementById("qrcode"), {
              text: JOIN_CODE,
              width: 100,
              height: 100,
              colorDark : "#000000",
              colorLight : "#ffffff",
              correctLevel : QRCode.CorrectLevel.H
            });

            // Join study text
            // JOIN_CODE was already defined above
            $('#opCodeText').text(GEN_TOKEN)
            $( '#opCodeCopy').on( "click", function() {
                navigator.clipboard.writeText(GEN_TOKEN).then(
                  () => {
                    // github-style conversion to green check mark and back
                    // after 5 seconds
                    $( '#opCodeCopy').removeClass("fa-copy");
                    $( '#opCodeCopy').addClass("fa-check");
                    $( '#opCodeCopy').css("color", "green");
                    setTimeout(() => {
                        $( '#opCodeCopy').removeClass("fa-check");
                        $( '#opCodeCopy').addClass("fa-copy");
                        $( '#opCodeCopy').css("color", "black");
                    }, 5000);
                    // alert("Copied opcode "+GEN_TOKEN+" to clipboard");
                  },
                  () => {
                    alert($.i18n("errorCopyingToClipboard")+": '"+GEN_TOKEN+"'");
                  }
                );
            } );
            $('#validProgram').hide();
        } catch (err) {
            setInvalid($.i18n("tokenCreationError"), err,
                $.i18n("contactForAssistance", data.intro.program_admin_contact));
        }

      }

      const hideTokenAndURL = function() {
        $('#validStudy').hide();
      }

      const redisplayPage = function() {
          $('html').i18n();
          fillDynamicConfig();
      }

      const setLangAndRedisplayPage = function() {
        curr_lang = $( '#langSel option:selected' ).val();
        $.i18n().locale = curr_lang;
        redisplayPage();
      }

      /*
       * We have two async loads - one of the dynamic config and the other of
       * the i18n. Right now, they are launched at different times, which makes
       * it hard to synchronize them. This is even more important when we want
       * to fill in parts of the i18n with the values from the dynamic config.
       * Our solution is two-fold:
       * - we load both languages and the dynamic config using promises
       * - after loading, we apply the values
       *
       * Applying the values involves:
       * - only after the first load, creating the token and the token URL
       * - after the first load and on every language change:
       *    - applying the raw i18n (which will fill in all the `data-i18n` values)
       *    - applying the dynamic config (which will replace the text for the
       *    dynamically configured values
       */

      // Enable debug
      $.i18n.debug = true;

      $(document).ready(function() {
        STUDY_NAME = _getStudyName(window.location);
        const CONFIG_URL = `https://raw.githubusercontent.com/e-mission/nrel-openpath-deploy-configs/main/configs/${STUDY_NAME}.nrel-op.json`;

        // set the initial value to the current language
        // otherwise, if the dropdown is set to es and we reload the page, the
        // text changes to en, but the dropdown stays as es
        // we use the non-changing version of the selection because we don't
        // want to redisplay the text twice
        // https://stackoverflow.com/a/16979926/4040267
        $('#langSel').val(curr_lang);
        const SUPPORTED_LANGUAGES = $.map($('#langSel')[0].options, (e) => e.value);
        console.log("After reading from options, languages are ", SUPPORTED_LANGUAGES);

        // Start out by assuming a valid study
        $('#invalidStudy').hide();

        // BEGIN: First round of loading
        const dynamicLoadPromise = fetch(CONFIG_URL).then((resp) => resp.json());
        // i18n.load returns a jquery promise, but apparently, since jquery3,
        // they are ES2015 compatible, so we don't need to wrap them
        // also we first load only the default language, so we can display the page ASAP
        const i18nLoadPromise = $.i18n().load('i18n/'+curr_lang+'.json', curr_lang);
        const allAsyncLoadPromises = [i18nLoadPromise, dynamicLoadPromise];
        console.log("First round promises", allAsyncLoadPromises);

        Promise.all(allAsyncLoadPromises).then(([i18nLoadResult, dynamicLoadResult]) => {
            console.log("Async results are ", i18nLoadResult, dynamicLoadResult);
            data = dynamicLoadResult;
            // TODO: Remove backwards compatibility at the end of 2024, once all
            // current programs have completed
            OPCODE_AUTOGEN = data.opcode?.autogen || data.intro.program_or_study == "study";
            if (OPCODE_AUTOGEN) {
                validateAndGenerateToken();
            } else {
                hideTokenAndURL();
            }
            redisplayPage();
        }).catch((error) => setInvalid($.i18n("errorLoadingPageElements"),
            error, $.i18n("contactForAssistance", "k.shankari@nrel.gov")));
        // the error elements are hardcoded here because we may have an error
        // in loading the i18n, in which case we will not have i18n-ized text
        // available to display.
        // END: First round of loading

        // BEGIN: Second round of loading
        // then, we load all the other languages
        const toLoadLanguages = SUPPORTED_LANGUAGES.filter((l) => l != curr_lang);
        const otherI18nLoadPromises = toLoadLanguages.map((l) => $.i18n().load('i18n/'+l+'.json', l));
        console.log("Second round promises of length ", otherI18nLoadPromises.length,
            " to load ", toLoadLanguages);

        // we are just pre-loading the other languages in case the user selects them
        // if we have too many languages, we might actually want to remove the preload
        // and keep it lazy
        // since we are preloading, all we want to do once the load is done is to
        // enable the language dropdown
        // Note that the dropdown is disabled by default
        // https://stackoverflow.com/questions/1414365/disable-enable-an-input-with-jquery
        Promise.all(otherI18nLoadPromises).then(() => {
            console.log("Finished loading other languages "+toLoadLanguages);
            $('#langSel').prop('disabled', false)
        });
        // END: Second round of loading
      });

		</script>

	</body>
</html>
