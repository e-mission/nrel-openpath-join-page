<!DOCTYPE html>

<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="Content-Security-Policy" content="base-uri 'self'; default-src 'self' 'unsafe-inline' data: https://raw.githubusercontent.com https://cdn.jsdelivr.net https://stackpath.bootstrapcdn.com https://fonts.googleapis.com/ https://fonts.gstatic.com https://cdnjs.cloudflare.com https://code.jquery.com https://kit.fontawesome.com https://ka-f.fontawesome.com;">
		<title>NREL CanBikeCO Dashboard</title>

		<!-- == APPLICATION HEAD == -->
		<!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KG7PVKB');</script>
		<!-- End Google Tag Manager -->

		<!-- Search engine code -->
		<!--#config timefmt="%Y-%m-%d@%H:%M:%S %Z" -->
		<meta http-equiv="last-modified" content="<!--#echo var='LAST_MODIFIED'-->">

		<!-- Favicon -->
		<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

		<!-- iOS icons -->
		<link rel="apple-touch-icon" href="client/img/touch-icon-iphone.png">
		<link rel="apple-touch-icon" sizes="72x72"   href="client/img/touch-icon-ipad.png">
		<link rel="apple-touch-icon" sizes="114x114" href="client/img/touch-icon-iphone-retina.png">
		<link rel="apple-touch-icon" sizes="144x144" href="client/img/touch-icon-ipad-retina.png">

		<!-- GLOBAL styles -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link href="client/css/nrel.complete.min.css" rel="stylesheet" type="text/css" >

		<!-- NREL Application styles -->
		<link href="client/css/nrel.application.min.css" rel="stylesheet" type="text/css" >

		<!-- Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"> 

		<!-- Font Awesome -->
		<script src="https://kit.fontawesome.com/32f532493a.js" crossorigin="anonymous"></script>

		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.6.1.min.js"   integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="   crossorigin="anonymous"></script>

        <!-- QRcode -->
        <script src="client/js/qrcode.js"></script>

    <!-- i18n from CDN-->
    <script src="https://cdn.jsdelivr.net/npm/cldrpluralruleparser@1.4.0/dist/cldrpluralruleparser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.messagestore.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.fallbacks.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.language.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.parser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.emitter.min.js"></script>

    <!-- Language button styling -->    

      <style>

      .box {
        height: 36px;
        width: 110px;
        background-color: #ffffff;
        outline: 2px solid rgb(141, 195, 239);
      }
      .boxOption {
        background-color: rgb(255, 255, 255);
      }      

      </style>

		<!-- == END APPLICATION HEAD == -->
	</head>
	<body>

    <!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KG7PVKB"
              height="0" width="0" style="display:none;visibility:hidden" sandbox="allow-same-origin"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Site application banner -->
    <!--stopindex-->
    <a href="#content" class="sr-only app">Skip to main content</a>

    <header id="banner">
    <div class="banner-logo">
    <div class="container app">
      <div class="row">

        <div class="col-md-6 col-xl-4 order-md-2">
          <a href="http://www.nrel.gov"><div class="logo"><img src="client/img/nrel-logo-web.svg" height="100%" width="100%" alt="National Renewable Energy Laboratory" /></div></a>
        </div>

        <div class="col-12 d-md-none">
          <!-- Start MOBILE collapsible site search bar -->
          <div class="site-search-bar">
            <div class="container">
              <div class="row">
                <div class="col d-flex justify-content-center">
                  <nav class="navbar navbar-light">
                    <div class="navbar-collapse collapse" id="searchbar-collapse-mobile">
                      <form
                          method="get"
                          class="site-searchbar-form form-inline ThunderstoneForm"
                          action="https://search4.nrel.gov/texis/search/" 
                          id="ThunderstoneSearchForm">

                        <input type="hidden" name="pr" value="metanrel" />
                        <div class="form-group">
                            <label for="query" class="searchFiler sr-only">NREL.gov</label>
                            <input
                                type="search"
                                id="query" name="query"
                                maxlength="2047"
                                placeholder="NREL.gov"
                                class="form-control"
                                aria-label="NREL.gov">
                            <button type="submit" class="search btn btn-default">Search</button>
                        </div>
                      </form>
                    </div>
                  </nav>
                </div>
              </div>
            </div>
          </div>    
          <!-- End MOBILE collapsible site search bar -->
        </div>

        <div class="d-flex align-items-center col-md-6 col-xl-8 order-md-1">
          <a class="app-name d-flex flex-wrap my-2">
            <span id="pageTitle" class="app-name">NREL OpenPATH</span>
            <span class="app-name">:&nbsp;</span>
            <span data-i18n="joinPage" class="app-name">Join Page</span>
          </a>
        </div>

      </div>
    </div>
    </div>
    </header>
    <!--startindex-->


    <!-- TOP NAVIGATION -->
    <!--stopindex-->
    <div class="program-header">
    <div class="container">
    <nav class="navbar navbar-expand-md navbar-light">

      <div id="program-menu" class="mr-auto">
        <button class="custom-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#topnav-collapse" aria-controls="topnav-collapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggle-label">Menu</span>
        </button>
      </div>

      <!-- Navigation -->
      <div class="navbar-collapse collapse" id="topnav-collapse">
        
        <ul class="nav navbar-nav">
          <li data-topnav="Public Dashboard" class="nav-item"><a id="publicDashboardLink" href="should_be_the_public_dashboard_link" data-i18n="publicDashboard" class="nav-link">Public Dashboard</a></li>
          <li data-topnav="Participant Guidelines" class="nav-item"><a id="participantGuidelinesLink" href="https://www.nrel.gov/transportation/openpath-participant-guidelines.html" data-i18n="participantGuidelines" class="nav-link">Participant Guidelines</a></li>
          <li data-topnav="TSDC" class="nav-item"><a id="TSDCLink" href="https://www.nrel.gov/transportation/secure-transportation-data/index.html" data-i18n="tsdc" class="nav-link">TSDC</a></li>
        </ul>
        <ul class="nav navbar-nav ml-auto">
          <!--Navigation tabs are commented out for reference
          <li class="nav-item"><a href="#" class="nav-link">Login</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Help</a></li>
          -->
        </ul>
        <!-- desktop search button -->
        <button type="button" class="custom-toggler site-navbar-toggler site-searchbar-toggle d-none d-md-inline" data-toggle="collapse" data-target="#searchbar-collapse" aria-expanded="false" aria-label="Toggle Search">
          <span class="fa fa-search" aria-hidden="true"></span>
        </button>

      <!-- Language select button-->
      <div class="lead">
        <select name="Select language" id="langSel" class="language box custom-select sources" onchange="setLangAndRedisplayPage()" disabled>
          <!-- now being generated in script! -->
        </select>
      </div>

      </div>

    </nav>
    </div><!--container-->
    </div><!--program-header-->
    <!-- mobile search button -->
    <button type="button" class="custom-toggler site-navbar-toggler site-searchbar-toggle d-md-none" data-toggle="collapse" data-target="#searchbar-collapse-mobile" aria-expanded="false" aria-label="Toggle Search">
    <span class="fa fa-search" aria-hidden="true"></span>
    </button>   
    <!-- Start collapsible site search bar -->
    <div class="site-search-bar">
    <div class="container">
    <div class="row">
      <div class="col">
        <nav class="navbar navbar-light">
          <div class="navbar-collapse collapse" id="searchbar-collapse">
            <form
                method="get"
                class="site-searchbar-form form-inline ThunderstoneForm"
                action="https://search4.nrel.gov/texis/search/" 
                id="ThunderstoneSearchForm">

              <input type="hidden" name="pr" value="metanrel" />
              <div class="form-group">
                  <label for="query" class="SearchFiler sr-only">NREL.gov</label>
                  <input
                      type="search"
                      id="query" name="query"
                      maxlength="2047"
                      placeholder="NREL.gov"
                      class="form-control"
                      aria-label="NREL.gov">
                  <button type="submit" class="Search btn btn-default">Search</button>
              </div>
            </form>
          </div>
        </nav>
      </div>
    </div>
    </div>
    </div>  
    
    <!-- End collapsible site search bar -->
    <!--startindex-->

		<div class="container" id="content" role="main">
         <div class="row">
            <div class="col-lg-9">
               <h1 id="studyTitleOne"></h1>
               <p class="greeting"></p>

              <p style="display:inline;">
                <span data-i18n="thankYouMessage" class="lead">Thank you for participating in </span>
                <span id="studyTitleTwo" class="lead"></span><span>.</span>
              </p>

              <p></p> <!-- Adds a precise space-->
                              
               <h2 data-i18n="studyPurpose">Purpose of Study</h2>

               <p id="shortTextualDescription"></p>
               
               <h2 data-i18n="dataCollection">Data Collection</h2>
               
               <p style="display:inline;">
                <span data-i18n="dC1">We use the </span>
                <a href="https://www.nrel.gov/transportation/openpath.html">NREL OpenPATH</a> 
                <span data-i18n="dC2"> platform for this data collection. This open-source platform collects a complete snapshot 
                  of your travel and uses it to estimate yourindividual transportation carbon 
                  footprint and compare it against US 2030 and 2050 carbon-reduction goals. It also computes and 
                  publishes aggregate metrics around mode share and distance traveled. </span> 
               </p>

               <p></p> <!-- Adds a precise space-->

               <div class="row justify-content-center">
                     
                 <div class="col-md-6 mb-4"><img id="OpenPATH-dashboard-image" class="img-responsive img-fluid" src="client/img/OpenPATH-dashboard-preview-en.png" alt="OpenPATH dashboard preview"></div>
                 <div class="col-md-6 mb-4"><img id="" class="img-responsive img-fluid" src="client/img/public-dashboard-preview.png" alt="Public dashboard preview"></div>

               </div>
               <p id="whyWeCollect"></p>
               
               <h2 data-i18n="installNREL">Install the NREL OpenPATH App on Your Phone</h2>
               
               <ol>
                  <li>
                    <p style="display:inline;">
                      <span data-i18n="iN1">Download the NREL OpenPATH app from the</span>
                      <a href="https://apps.apple.com/us/app/nrel-openpath/id1628058068">Apple Store</a>
                      <span data-i18n="iN2"> or </span>
                      <a href="https://play.google.com/store/apps/details?id=gov.nrel.cims.openpath">Google Play Store</a>
                      <span>.</span>
                      
                    </p>
                  </li>
                  
                  <li data-i18n="iN3">
                    Join the study using a QR code or access link (described below).
                  </li>
                  
                  <li data-i18n="iN4">Remember to give all the requested permissions, including ("always") background location
                     access. If you have a Samsung or Huawei phone, turn off background restrictions.
                  </li>
                  
                  <li data-i18n="iN5">Track your trips, label them when prompted, and check out your carbon footprint.</li>
                  
               </ol>
               <p>
                <span data-i18n="iN6">For additional information, see the </span>
                <a data-i18n="iN7" href="https://www.nrel.gov/transportation/openpath-participant-guidelines.html">
                  participant guidelines
                </a><span>.</span>
              </p>
               
               <div id="validStudy" class="well text-center">
                  
                  <h2 data-i18n="joinStudy">Join the Study</h2>

                  <div class="d-flex flex-column justify-content-center py-2">
                    <div id="joinQrRow" class="justify-content-center">
                      <p data-i18n="joinAutogenQrDesc">
                        After you have installed the NREL OpenPATH app on your phone, join the study by
                        scanning the QR code or copying the link and pasting it into the app.
                      </p>
                      <div id="joinQrCode" class="m-auto" style="width:150px; height:150px"></div>
                    </div>
                    <div id="joinButtonRow" class="justify-content-center">
                      <p data-i18n="joinAutogenButtonDesc">
                        After you have installed the NREL OpenPATH app on your phone, join the study
                        by clicking the button below or copying the link and pasting it into the app.
                      </p>
                      <button id="joinButton" class="btn btn-primary">
                        <b data-i18n="join">Join</b>
                      </button>
                    </div>

                    <div class="alert alert-secondary d-flex align-items-center py-1 my-2 mx-auto">
                      <span id="joinCodeText" class="small text-monospace text-break"></span>
                      <span class="pl-2 fa fa-copy" id="joinCodeCopy"></span>
                    </div>
                  </div>

                  <p data-i18n="[html]joinAutogenOpcodeDesc" class="m-0">
                    When you join the study, you will be randomly assigned an OPcode, which is a
                    long string beginning with <code>nrelop_</code>. You will be asked to save your
                    OPcode in case you lose or change phones. If you lose your token, NREL cannot
                    retrieve it for you since we do not have the ability to match a token to an
                    individual user.
                  </p>

               </div>
               <div id="validProgram" class="well text-center">

                  <h2 data-i18n="joinStudy">Join the Study</h2>

                  <p data-i18n="[html]joinAssignedQrDesc">
                    After you have installed the NREL OpenPATH app on your phone, join the program
                    by scanning the QR code or copy-pasting the OPcode provided by your program admin.
                    The OPcode is a long string beginning with <code>nrelop_</code>
                  </p>

                  <div class="row justify-content-center">

                    <div id="program-instructions" class="row" style="width:400px; margin-top:15px;">
                        <img class="col col-50" src="client/img/capture_qr_code_mobile_phone.jpg">
                        <img class="col col-50" src="client/img/copy_paste_token.jpg">
                    </div>
                  </div>
                  
                  <p data-i18n="joinAssignedOpcodeDesc">
                    The OPcode is a randomly generated token. Keep your OPcode in a safe place in
                    case you lose or change phones. If you lose your OPcode, please contact your
                    program admin for assistance. NREL cannot retrieve it for you since we do not
                    have the ability to match a token to an individual user.
                  </p>
               </div>
                <div id="invalidStudy" class="well text-center">
                  <h2 data-i18n="invalidStudyTitle" style="color:red;">Invalid Study</h2>
                  <b><p id="invalidLocation"></p></b>
                  <p id="invalidMessage"></p>
                  <i><p id="invalidContact"></p></i>
                </div>


               <h2 data-i18n="dataPrivacy">Data Privacy and Security</h2>
               
               <p style="display:inline;">
                <span data-i18n="dP1">The system </span>
                <strong data-i18n="dP2">will not</strong>
                <span data-i18n="dP3">collect any of the traditional personally identifiable information (i.e., no name,
                  email, or phone number).</span>
              </p>

              <p></p><!-- Adds a precise space-->

               <p id="tokenPrivacyInfo"></p>
               
               <p data-i18n="dP4">The collected data will be stored in a FEDRAMP-certified medium cluster at NREL and
                  encrypted both in transit and at rest. Data from this study will be stored separately
                  from other study data using the NREL-hosted version of the OpenPATH platform.
               </p>
               
               <p data-i18n="dP5">The raw data from this study will only be made available to:</p>
               
               <ul>
                
                  <li>
                    <p style="display:inline;">
                      <span data-i18n="dP6">Program administrators from </span>
                      <a id="deploymentPartnerName"></a>
                      <span data-i18n="dP7"> to monitor the </span>
                      <a id="programOrStudy"></a>
                      <span data-i18n="dP8"> and potentially send recommendations for alternate travel modes.</span>
                    </p>
                  </li>
                  
                  <li data-i18n="dP9">NREL OpenPATH developers for debugging.</li>

               </ul>
               
               <p style="display:inline;">
                <span data-i18n="dP10">On completion of the study, the data will be archived in NREL's </span>
                <a data-i18n="dP13" href="https://www.nrel.gov/transportation/secure-transportation-data/index.html">Transportation Secure Data Center</a>
                <span data-i18n="dP11"> to support travel behavior research.</span>
                </p>

                <p></p><!-- Adds a precise space-->
               
               <p data-i18n="dP12">Examples of research that might use the data include:</p>
               
               <div id="researchQuestions"></div>
               
               <h2 data-i18n="contact">Contact</h2>
               
               <div class="bio">
                  <p class="header">K. Shankari</p>
                  <p data-i18n="contactTitle" class="header-description">Postdoctoral Researcher, Director's Fellow</p><a href="mailto:K.Shankari@nrel.gov"><span class="fa fa-envelope" aria-hidden="true"></span>K.Shankari@nrel.gov</a><br><a href="tel:+1-303-384-6450"><span class="fa fa-phone-square" aria-hidden="true"></span>303-384-6450</a></div>
               
            </div>
				</nav>
 			</div><!--container-->
 		</div><!--program-header-->

 		<!-- == APPLICATION FOOTER | updated 3/2021 == -->
 		<!--stopindex-->
    <footer id="footer" class="hidden-print">

      <div class="footertop">
           <div class="container">
              <div class="row">
                  <div class="col-12 col-lg-5">
                      <a href="http://www.nrel.gov/index.html"><strong class="nrel">National Renewable Energy Laboratory</strong></a>
                  </div>
                  <div class="col col-lg-7">
                      <div class="d-flex flex-column flex-lg-row justify-content-lg-start global">
                          <div><a data-i18n="about" href="http://www.nrel.gov/about/index.html">About</a></div>
                          <div><a data-i18n="research" href="http://www.nrel.gov/research/index.html">Research</a></div>
                          <div><a data-i18n="workWithUs" href="http://www.nrel.gov/index.html">Work with Us</a></div>
                          <div><a data-i18n="news" href="http://www.nrel.gov/news/index.html">News</a></div>
                          <div><a data-i18n="careers" href="http://www.nrel.gov/careers/index.html">Careers</a></div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="footerbottom">
           <div class="container">
               <div class="row">
                  <div class="col-md-4 col-lg-5">
                      <div><a data-i18n="contactUs" href="http://www.nrel.gov/webmaster.html">Contact Us</a></div>
                      <div class="mt-2"><a data-i18n="visit" href="http://www.nrel.gov/about/visiting-nrel.html">Visit</a></div>
                      <div class="mt-2"><a data-i18n="subscribe" href="http://www.nrel.gov/news/subscribe.html">Subscribe</a></div>
                      <div class="mt-3">
                          <ul class="social-links list-inline">
                              <li class="list-inline-item"><a href="https://www.facebook.com/nationalrenewableenergylab" aria-label="Follow NREL on Facebook"><i class="fa fa-facebook-square"><!--facebook--></i></a>
                              </li>
                              <li class="list-inline-item"><a href="https://www.instagram.com/nationalrenewableenergylab/" aria-label="Follow NREL on Instagram"><i class="fa fa-instagram"><!--Instagram--></i></a></li>
                              <li class="list-inline-item"><a href="https://www.linkedin.com/company/national-renewable-energy-laboratory"
                                  aria-label="Follow NREL on Linked In"><i class="fa fa-linkedin-square"><!--Linked In--></i></a>
                              </li>
                              <li class="list-inline-item"><a href="https://www.youtube.com/user/NRELPR/" aria-label="Follow NREL on YouTube"><i class="fa fa-youtube"><!--You Tube--></i></a>
                              </li>
                              <li class="list-inline-item"><a href="https://twitter.com/nrel/" aria-label="Follow NREL on Twitter"><i class="fa fa-twitter"><!--twitter--></i></a>
                              </li>
                          </ul>
                      </div>
                  </div>
                  <div class="col-md-8 col-lg-7 globalsecondary">
                      <div class="row">
                          <div class="col-sm-6 col-lg-3">
                              <div class="mt-1"><a data-i18n="accessibility" href="http://www.nrel.gov/accessibility.html">Accessibility</a></div>
                              <div class="mt-1"><a data-i18n="disclaimer" href="http://www.nrel.gov/disclaimer.html">Disclaimer</a></div>
                              <div class="mt-1"><a data-i18n="snp" href="http://www.nrel.gov/security.html">Security and Privacy</a></div>
                              <div class="mt-1"><a data-i18n="siteFeedback" href="http://www.nrel.gov/webmaster.html">Site Feedback</a></div>
                          </div>
                          <div class="col-sm-6 col-lg-3">
            
                              <div class="mt-1"><a data-i18n="developers" href="https://developer.nrel.gov/">Developers</a></div>
                              <div class="mt-1"><a data-i18n="employees" href="https://thesource.nrel.gov/">Employees</a></div>
                          </div>
                      </div>
                  </div>
              </div>
               <hr />
               <div class="mt-4">
               <div class="row">
                   <div class="col-sm-5">
                       <a href="https://www.allianceforsustainableenergy.org/"><img class="mr-5 mb-3" src="client/img/alliance-logo_black.png" alt="Alliance for Sustainable Energy, LLC"></a>
                       <a href="https://www.energy.gov"><img src="client/img/logo-doe-footer.png" alt="U.S. Department of Energy" class="mb-3"></a>
                   </div>

                   <div class="col-12 col-sm-7">
                    <p class="nrel-attr" style="display:inline;">
                      <span data-i18n="ft1">The National Renewable Energy Laboratory is a national laboratory of the </span>
                      <a data-i18n="usde" href="https://www.energy.gov/">U.S. Department of Energy</a>,
                      <a data-i18n="oeere" href="https://www.energy.gov/eere/office-energy-efficiency-renewable-energy">Office of Energy Efficiency and Renewable Energy</a>
                      <span data-i18n="ft2">, operated by the </span>
                      <a data-i18n="ase" href="https://www.allianceforsustainableenergy.org/">Alliance for Sustainable Energy LLC</a>.
                    </p>

                    
                  </div>
              </div>
               </div>
          </div>
      </div>

  </footer>

    <!--startindex-->
		<!-- == END APPLICATION FOOTER == -->

		<!-- == GLOBAL APPLICATION SCRIPTS == -->
		<!-- Bootstrap -->
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<!-- Global scripts -->
		<script src="client/js/app.min.js"></script>

		<!-- Site application scripts -->
		<script src="client/js/plugins.min.js"></script>
		<script src="client/js/app.min.js"></script>

		<!-- Custom scripts -->
		<script type="text/javascript">
      /**
       * @returns The study name for a URL, which is:
       *           - the value of the 'study_config' query parameter if present,
       *           - the first part of the hostname before '-openpath' if present,
       *           - 'stage' if the first part of the hostname is 'openpath-stage',
       *           - undefined if it can't be determined
       * @example getStudyNameFromUrl(new URL('https://openpath-stage.nrel.gov/join/')) => 'stage'
       * @example getStudyNameFromUrl(new URL('https://open-access-openpath.nrel.gov/join/')) => 'open-access'
       * @example getStudyNameFromUrl(new URL('https://nrel-commute-openpath.nrel.gov/api/')) => 'nrel-commute'
       * @example getStudyNameFromUrl(new URL('http://localhost:3274/?study_config=foo')) => 'foo'
       */
      function getStudyNameFromUrl(url) {
        const studyConfigParam = url.searchParams.get('study_config');
        if (studyConfigParam) return studyConfigParam;
        const firstDomain = url.hostname.split('.')[0];
        if (firstDomain == 'openpath-stage') return 'stage';
        const openpathSuffixIndex = firstDomain.indexOf('-openpath');
        if (openpathSuffixIndex == -1) return undefined;
        return firstDomain.substring(0, openpathSuffixIndex);
      }

     /*
     function to populate the language menu
     takes list of supported languages (from config) 
     and a map from language codes to their names (from i18n.json files)
     reference: https://dev.to/dcodeyt/3-easy-ways-to-generate-html-with-javascript-3b1j (adapted 1st way)
     */
     const makeLanguageMenu = function(languages, map)
     {
        console.log("data?", languages, map);
        const language_list_element = document.querySelector("#langSel");
        language_list_element.innerHTML = "";
        for(let i = 0; i < languages.length; i++)
        {
          lang = languages[i];
          // console.log("language", lang);
          const lang_opt = document.createElement("option");
          lang_opt.classList.add("boxOption");
          lang_opt.setAttribute("value", lang);
          if(map){
            // console.log(map[lang]);
            lang_opt.textContent = map[lang];
          }
          else{
            lang_opt.textContent = lang;
          }

          language_list_element.appendChild(lang_opt);
        }
     }

      var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      var curr_lang; //language not set until dynamic config is loaded! (dynamic default)
      var data;
      var PAGE_URL;
      var STUDY_NAME;
      var OPCODE_AUTOGEN;
      var SUPPORTED_LANGUAGES;
      var LANG_TO_NAME;

      const fillDynamicConfig = function() {
        // Title card
        const PAGE_TITLE_TEXT = `${data.intro.translated_text[curr_lang].deployment_name}`;
        $('#pageTitle').text(PAGE_TITLE_TEXT);
        document.title = PAGE_TITLE_TEXT;
        
        // Navigation links
        const PUBLIC_DASHBOARD_LINK = data.server.connectUrl.replace("api", "public");;
        $('#publicDashboardLink').attr('href', PUBLIC_DASHBOARD_LINK);

        // Deployment partner content text
        const DEPLOYMENT_PARTNER_NAME = `${data.intro.translated_text[curr_lang].deployment_partner_name}`;
        $('#deploymentPartnerName').text(DEPLOYMENT_PARTNER_NAME);
        
        // Program or study specific differences
        const PROGRAM_OR_STUDY = `${data.intro.program_or_study}`;
        $('#programOrStudy').text(PROGRAM_OR_STUDY);

        // Study title content text
        const STUDY_TITLE_TEXT = DEPLOYMENT_PARTNER_NAME + ` ${data.intro.translated_text[curr_lang].deployment_name}`;
        $('#studyTitleOne').text(STUDY_TITLE_TEXT);
        $('#studyTitleTwo').text(STUDY_TITLE_TEXT);

        // Short textual description content text
        const SHORT_TEXTUAL_DESCRIPTION_TEXT = `${data.intro.translated_text[curr_lang].short_textual_description}`;
        $('#shortTextualDescription').text(SHORT_TEXTUAL_DESCRIPTION_TEXT);
        
        // Why we collect content text
        const WHY_WE_COLLECT_TEXT = `${data.intro.translated_text[curr_lang].why_we_collect}`;
        $('#whyWeCollect').text(WHY_WE_COLLECT_TEXT);

        // OpenPATH dashboard image preview
        var img = document.getElementById("OpenPATH-dashboard-image");
        img.src=`client/img/OpenPATH-dashboard-preview-${curr_lang}.png`;

        // console.log("Configured study text is "+$.i18n("tokenPrivacyInfoStudyText"));
        // console.log("Configuring the program text with "+DEPLOYMENT_PARTNER_NAME);
        // Token privacy content text
        const TOKEN_PRIVACY_INFO_STUDY_TEXT = $.i18n("tokenPrivacyInfoStudyText");
        const TOKEN_PRIVACY_INFO_PROGRAM_TEXT = $.i18n("tokenPrivacyInfoProgramText", DEPLOYMENT_PARTNER_NAME);
        // If it's a study, go with the study text. Else go with the program text
        const TOKEN_PRIVACY_INFO_TEXT = OPCODE_AUTOGEN? TOKEN_PRIVACY_INFO_STUDY_TEXT : TOKEN_PRIVACY_INFO_PROGRAM_TEXT;
        $('#tokenPrivacyInfo').text(TOKEN_PRIVACY_INFO_TEXT);

        // Research questions generation
        $("#cList").remove();
        $('#researchQuestions').append("<ul id='cList'></ul>");
        for (i = 0; i < 3; i++) { // 3 research questions maximum
          var RESEARCH_QUESTION_TEXT = `${data.intro.translated_text[curr_lang].research_questions[i]}`;
          if(RESEARCH_QUESTION_TEXT == "undefined") { // Skip the entry if is not defined.
            continue;
          }
          $("#cList").append("<li>" + RESEARCH_QUESTION_TEXT + "</li>");
        }

      };

      const setInvalid = function(invalidLoc, invalidMessage, invalidContact) {
        alert(invalidLoc + "\n\n\n" + invalidMessage+ "\n\n\n" + invalidContact);
        $('#validStudy').hide();
        $('#validProgram').hide();
        $('#invalidLocation').text(invalidLoc);
        $('#invalidMessage').text(invalidMessage);
        $('#invalidContact').text(invalidContact);
        $('#invalidStudy').show();
      }

      const generateJoinCode = function() {
        try {
            const joinUri = new URL(`nrelopenpath://join?study_config=${STUDY_NAME}`);
            for (let param of PAGE_URL.searchParams) {
              joinUri.searchParams.set(...param);
            }

            if(isMobile) {
              $('#joinButton').on("click", () => {
                  window.location.href = joinUri.href;
                  setTimeout(() => window.alert($.i18n('joinEnsureAppInstalled')), 100);
              });
              $('#joinQrRow').hide();
            } else {
              // Generate study-join QR code
              var qrcode = new QRCode(document.getElementById("joinQrCode"), {
                text: joinUri.href,
                width: 150,
                height: 150,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
              });
              $('#joinButtonRow').hide();
            }

            $('#joinCodeText').text(joinUri.href);
            $('#joinCodeCopy, #joinCodeText').on("click", () => {
                navigator.clipboard.writeText(joinUri.href).then(
                  () => {
                    // github-style conversion to green check mark and back
                    // after 5 seconds
                    $( '#joinCodeCopy').removeClass("fa-copy");
                    $( '#joinCodeCopy').addClass("fa-check");
                    $( '#joinCodeCopy').css("color", "green");
                    setTimeout(() => {
                        $( '#joinCodeCopy').removeClass("fa-check");
                        $( '#joinCodeCopy').addClass("fa-copy");
                        $( '#joinCodeCopy').css("color", "black");
                    }, 5000);
                  },
                  () => {
                    alert($.i18n("errorCopyingToClipboard")+": '"+joinUri.href+"'");
                  }
                );
            } );
            $('#validProgram').hide();
        } catch (err) {
            setInvalid($.i18n("tokenCreationError"), err,
                $.i18n("contactForAssistance", data.intro.program_admin_contact));
        }

      }

      const hideTokenAndURL = function() {
        $('#validStudy').hide();
      }

      const redisplayPage = function() {
          $('html').i18n();
          fillDynamicConfig();
      }

      const setLangAndRedisplayPage = function() {
        curr_lang = $( '#langSel option:selected' ).val();
        $.i18n().locale = curr_lang;
        redisplayPage();
      }

      /*
      function to make language code to language name maps
      takes in the list of languages a map is desired for
      returns a mapping object - key/val pairs
      */
      const makeKeyNameMap = function (lang_list)
      {
        var langMap = {};
        for(let i = 0; i < lang_list.length; i++)
        {
          const key = lang_list[i];
          $.i18n().locale = key;
          langMap[key] = $.i18n('language_name');
        }
        //console.log("map", langMap);
        $.i18n().locale = curr_lang; //resetting the language to what's selected
        return langMap;
      }

      /*
      scrapes lanauges supported from dynamic config
      used to populate options in the menu
      */
      const getSupportedLanguages = function()
      {
        const LANGUAGE_SETTINGS = data.intro.translated_text;
        const SUPPORTED_LANGUAGES = [];
        for(key in LANGUAGE_SETTINGS)
        {
          SUPPORTED_LANGUAGES.push(key);
        }
        console.log("languages", SUPPORTED_LANGUAGES);

        return SUPPORTED_LANGUAGES;
      }

      /*
       * We have two async loads - one of the dynamic config and the other of
       * the i18n. Right now, they are launched at different times, which makes
       * it hard to synchronize them. This is even more important when we want
       * to fill in parts of the i18n with the values from the dynamic config.
       * Our solution is two-fold:
       * - we load both languages and the dynamic config using promises
       * - after loading, we apply the values
       *
       * Applying the values involves:
       * - only after the first load, creating the token and the token URL
       * - after the first load and on every language change:
       *    - applying the raw i18n (which will fill in all the `data-i18n` values)
       *    - applying the dynamic config (which will replace the text for the
       *    dynamically configured values
       */

      // Enable debug
      $.i18n.debug = true;

      $(document).ready(async function() {
        PAGE_URL = new URL(window.location);
        STUDY_NAME = getStudyNameFromUrl(PAGE_URL) || 'stage-program';
        const CONFIG_URL = `https://raw.githubusercontent.com/e-mission/nrel-openpath-deploy-configs/main/configs/${STUDY_NAME}.nrel-op.json`;
        // set the initial value to the current language
        // otherwise, if the dropdown is set to es and we reload the page, the
        // text changes to en, but the dropdown stays as es
        // we use the non-changing version of the selection because we don't
        // want to redisplay the text twice --- oooh is this our problem?
        // https://stackoverflow.com/a/16979926/4040267

        // Start out by assuming a valid study
        $('#invalidStudy').hide();


        //async - await being used since language depends heavily on dynamic config
        
        //load the dynamic config
        const dynamicLoadPromise = fetch(CONFIG_URL).then((resp) => resp.json());
        console.log("Dynamic Config Promise", dynamicLoadPromise);
        data = await dynamicLoadPromise; 
        //don't continue until data is defined and config is loaded
        console.log("Dynamic Config result is", data);

        //create token and token url
        if(typeof data.opcode?.autogen !== 'undefined') { //if the autogen property is set, use it
          console.log("found opcode setting, is", data.opcode.autogen);
          OPCODE_AUTOGEN = data.opcode?.autogen;
        } else { //else fall back to program vs study
          console.log("falling back to program vs study", data.intro.program_or_study);
          OPCODE_AUTOGEN = data.intro.program_or_study == "study";
        }

        if (OPCODE_AUTOGEN) {
          generateJoinCode();
        } else {
          hideTokenAndURL();
        }
        SUPPORTED_LANGUAGES = getSupportedLanguages();

        //load the default (first listed in translated) language
        const default_language = SUPPORTED_LANGUAGES[0];//default should be set up to be the first language!
        console.log("language default is", default_language);
        curr_lang = default_language;
          
        // i18n.load returns a jquery promise, but apparently, since jquery3,
        // they are ES2015 compatible, so we don't need to wrap them
        // also we first load only the default language, so we can display the page ASAP
        const defaultI18nLoadPromise = $.i18n().load('i18n/'+default_language+'.json', default_language);
        console.log("Default i18n Promise", defaultI18nLoadPromise); //supposed to be undefined? works and looks undefined in the original code?
        const i18nLoadResult = await defaultI18nLoadPromise;
        console.log("Default i18n result is", i18nLoadResult);

        //show the page now that we have sufficent information!
        $.i18n().locale = default_language;
        redisplayPage();
        
        //determined that traditional promise was working better than the await...
        const toLoadLanguages = SUPPORTED_LANGUAGES.filter((l) => l != curr_lang);
        const otherI18nLoadPromises = toLoadLanguages.map((l) => $.i18n().load('i18n/'+l+'.json', l));
        console.log("Second round promises of length ", otherI18nLoadPromises.length,
            " to load ", toLoadLanguages);

        // we are just pre-loading the other languages in case the user selects them
        // if we have too many languages, we might actually want to remove the preload
        // and keep it lazy
        // since we are preloading, all we want to do once the load is done is to
        // enable the language dropdown
        // Note that the dropdown is disabled by default
        // https://stackoverflow.com/questions/1414365/disable-enable-an-input-with-jquery
        Promise.all(otherI18nLoadPromises).then(() => {
            console.log("Finished loading other languages "+toLoadLanguages);
            //now that all i18n have been loaded, get map
            LANG_TO_NAME = makeKeyNameMap(SUPPORTED_LANGUAGES);
            // populate the menu! (could be delayed if lots of languages?)
            makeLanguageMenu(SUPPORTED_LANGUAGES, LANG_TO_NAME);
            $('#langSel').prop('disabled', false);
            $('#langSel').val(default_language); //setting the menu value to the default language
        });
      });

		</script>

	</body>
</html>
